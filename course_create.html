<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Course</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    form { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; }
    input, select, button { width: 100%; margin-top: 10px; padding: 10px; }
    .loader { display: none; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; margin: 10px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

<h2>Create New Course</h2>
<form id="courseForm">
  <label>Title: <input type="text" id="title" required></label>
  <label>Days: <input type="number" id="days" required></label>
  <label>Level:
    <select id="level" required>
      <option value="">--Select--</option>
      <option>Beginner</option>
      <option>Intermediate</option>
      <option>Advanced</option>
    </select>
  </label>
  <label>Playlist:
    <select id="playlist" required>
      <option value="">--Select--</option>
      <option>True</option>
      <option>False</option>
    </select>
  </label>
  <button type="submit">Create Course</button>
  <div class="loader" id="courseLoader"></div>
  <p id="status" style="color:green;"></p>
</form>

<script>
document.getElementById("courseForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const title = document.getElementById("title").value;
  const days = parseInt(document.getElementById("days").value);
  const level = document.getElementById("level").value;
  const playlist = document.getElementById("playlist").value;

  document.getElementById("status").textContent = "⏳ Creating course...";
  document.getElementById("courseLoader").style.display = "block";

  try {
    const res = await fetch("http://127.0.0.1:8000/createcourse", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify({ title, days, level, playlist })
    });

    const data = await res.json();

    if (res.ok && data.course_id) {
      document.getElementById("status").textContent = "✅ Course created! Redirecting to match videos...";
      // Redirect to match_videos.html with the course_id
      setTimeout(() => {
        window.location.href = `match.html?course_id=${data.course_id}`;
      }, 1500); // Add a short delay so the user can see the success message
    } else {
      document.getElementById("status").textContent = "❌ Error: " + (data.detail || "Unknown error");
    }
  } catch (err) {
    document.getElementById("status").textContent = "❌ Error: " + err.message;
  } finally {
    document.getElementById("courseLoader").style.display = "none";
  }
});
</script>

</body>
</html>